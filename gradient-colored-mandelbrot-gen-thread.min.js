(function(){if(typeof Math!=="undefined"){Math.map=function(e,b,a,d,c){return(e-b)/(Math.abs(a-b))*Math.abs(c-d)+d}}if(typeof ImageData!=="undefined"){ImageData.prototype.setPixel=function(f,a,e){var d=this.data;var b=4*(a+e*this.width);d[b]=f[0];d[b+1]=f[1];d[b+2]=f[2];d[b+3]=f[3]};ImageData.prototype.getPixel=function(a,d){var c=this.data;var b=4*(a+d*this.width);return[c[b],c[b+1],c[b+2],c[b+3]]}}})();self.onmessage=function(b){var k=b.data;switch(k.message){case"generateFrame":var e=new Date().getTime();drawMandelbrotSet(k.startX,k.endX,k.startY,k.endY,k.imageData,k.gradient,k.canvasWidth,k.canvasHeight);var h=new Date().getTime();var f=h-e;self.postMessage({message:"frameGenerationComplete",imageData:k.imageData,timeTaken:f,generateFrame:true});break;case"generateVideo":var l=[];var d=k.frameStates.length;var a=false,c=false;for(var g=0;g<d;g++){a=k.frameStates[g];drawMandelbrotSet(a.startX,a.endX,a.startY,a.endY,k.imageData,k.gradient,k.canvasWidth,k.canvasHeight);c=new Uint8ClampedArray(k.imageData.data);l.push(c);self.postMessage({message:"progressUpdate",frameTotal:d,frameCount:g})}self.postMessage({message:"videoGenerationComplete",renderedFrames:l,generateVideo:true});break;case"generateZip":;if(typeof k.zip!=="undefined"){var j=k.zip.generate();self.postMessage({message:"generateZipComplete",content:j})}}};function drawMandelbrotSet(f,m,d,l,a,k,c,e){for(var j=0;j<c;j++){for(var i=0;i<e;i++){var g=Math.map(j,0,c,f,m);var b=Math.map(i,0,e,d,l);var h=mandelbrotSetEscapeRate(g,b);a.setPixel(k[h],j,i)}}}function mandelbrotSetEscapeRate(g,e){var b=0,a=0,f=500,c=0,h=0;var d;for(d=0;d<f;d++){if(b*b+a*a>4){break}c=b*b-a*a+g;h=2*b*a+e;b=c;a=h}return Math.floor(Math.map(d,0,f,0,254))};