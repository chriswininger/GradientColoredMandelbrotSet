(function(){if(typeof window.Math!=="undefined"){window.Math.map=function(e,b,a,d,c){return(e-b)/(Math.abs(a-b))*Math.abs(c-d)+d}}if(typeof window.ImageData!=="undefined"){ImageData.prototype.setPixel=function(f,a,e){var d=this.data;var b=4*(a+e*this.width);d[b]=f[0];d[b+1]=f[1];d[b+2]=f[2];d[b+3]=f[3]};ImageData.prototype.getPixel=function(a,d){var c=this.data;var b=4*(a+d*this.width);return[c[b],c[b+1],c[b+2],c[b+3]]}}String.prototype.padRight=function(f,b){var a=b-this.length,e="";for(var d=0;d<a;d++){e+=f}return this+e};String.prototype.padLeft=function(f,b){var a=b-this.length,e="";for(var d=0;d<a;d++){e+=f}return e+this}})();(function(){var L=-2,X=1,H=-1,W=1;var x=L,h=X,w=H,g=W;var P=500,m=400;var Q=false,N=false,B=false,z=false,b=false,O=false,r=false,k=false,T=false,S=false,E=false;var y=false,f=false,l=false,V=false,v=true,t=false;var n=[],M=[];var i=false,u=false,j=false,e=false,p=false;var C=[];var c=false;window.onload=function(){Q=$("#inputX1");N=$("#inputX2");B=$("#inputY1");z=$("#inputY2");r=$("#mandelbrot-color-video-progress");b=$("#lblStatus");O=$("#chkMandelbrotColorMaintainRatio");k=$("#long-load-display");T=$("#long-load-message");S=$("#lblSetInfo");E=$("#mandelbrot-color-download-tar");v=O.is(":checked");i=$("#cvsMandelbrot");P=i.width();m=i.height();u=i[0].getContext("2d");j=$("#imgGradient");p=R(j[0]);c=new Worker("gradient-colored-mandelbrot-gen-thread.min.js");c.onmessage=I;d(x,h,w,g,u,p);$("#btnUpdateMandelbrot").click(function(ai){K(q());return false});$("#play-long-video").click(function(ai){U()});$("#btnMandelbrotColorPlay").click(function(aj){t=true;M.push({startX:x,endX:h,startY:w,endY:g});for(var ai=0;ai<M.length;ai++){var ak=M[ai];K(ak)}t=false;M.pop()});E.click(function(ak){k.show();var al=new Array();var ai=0;var aj=function(){if(ai<C.length){T.text("Processing Frames...");var ao=$("<canvas>").attr("width",P).attr("height",m);var an=ao[0].getContext("2d");e.data.set(C[ai]);an.putImageData(e,0,0);var am=ao[0].toDataURL("image/jpeg",1);var ap=atob(am.substring(am.indexOf(",")+1));al.push({name:"p"+(ai.toString()).padLeft("0",10)+".jpeg",data:ap});r.attr("value",Math.round((ai/C.length)*100));ai++;window.setTimeout(aj,0)}else{T.text("Building Tar File...");jsTar.toTar(al,{complete:ag,error:aa,progress:ae})}};window.setTimeout(aj,0)});function ag(ai){k.hide();if(ai.status==="success"){window.location.href=window.URL.createObjectURL(ai.data)}else{alert(ai.message)}}function aa(ai){k.hide();alert(ai.message)}function ae(aj){var ai=Math.round((aj.count/aj.total)*100);r.attr("value",ai)}function ad(am){var aB="";for(var av=0,aD=false,aj,aF,aC;av<am.length;av++){aD=am[av];aj="";var az=aD;var aH=("p"+(av.toString()).padLeft("0",10)+".png").padRight("\0",100);var ar="0000664".padRight("\0",8);var ao=(1000).toString(8).padLeft("0",7).padRight("\0",8);var ay=(1000).toString(8).padLeft("0",7).padRight("\0",8);var ax=(aD.length).toString(8).padLeft("0",11).padRight("\0",12);var au="12123623701".padRight("\0",12);var an="        ";var aG="0";var ak="".padRight("\0",100);var ai="ustar  \0";var al="chris".padRight("\0",32);var at="chris".padRight("\0",32);aj=(aH+ar+ao+ay+ax+au+an+aG+ak+ai+al+at).padRight("\0",512);aF=0;for(var aA=0,aq;aA<aj.length;aA++){aq=aj.charCodeAt(aA);aF+=aq}an=(aF).toString(8).padLeft("0",6)+"\0 ";aC=(aH+ar+ao+ay+ax+au+an+aG+ak+ai+al+at).padRight("\0",512);aC+=az.padRight("\0",(512+Math.floor(az.length/512)*512));aB+=aC}aB+="".padRight("\0",1024);var ap=new Uint8Array(aB.length);for(var aw=0;aw<aB.length;aw++){ap[aw]=aB.charCodeAt(aw)}var aE=new Blob([ap.buffer],{type:"application/tar"});window.location.href=window.URL.createObjectURL(aE)}$("#btnMandelbrotColorGenerateVideo").click(function(ai){M.push({startX:x,endX:h,startY:w,endY:g});var au=[];var aj=false;for(var ao=0;ao<M.length;ao++){var at=M[ao];if(aj===false){au.push(at)}else{var ar=at.startX-aj.startX;var aq=at.startY-aj.startY;var ap=at.endX-aj.endX;var an=at.endY-aj.endY;var aw=ar/30;var av=aq/30;var al=ap/30;var ak=an/30;for(var am=1;am<=30;am++){au.push({startX:aj.startX+aw*am,endX:aj.endX+al*am,startY:aj.startY+av*am,endY:aj.endY+ak*am})}}aj=at}M.pop();c.postMessage({message:"generateVideo",generateVideo:true,frameStates:au,imageData:e,gradient:p,canvasWidth:P,canvasHeight:m});k.show()});$("#btnExportPath").click(function(aj){var ak=$.toJSON(M);var ai=new Blob([ak],{type:"text/plain;charset=utf-8"});saveAs(ai,"MandelBrotPath.txt")});O.change(function(ai){v=$(this).is(":checked")});$("#btnDefault").click(function(){K({startX:L,endX:X,startY:H,endY:W})});$("#fileGradientPicker").change(Y);i.mousedown(ab);i.mouseup(ac);i.mousemove(af);i.contextmenu(function(ai){return false});function af(ak){var ai=ak.pageX-$(this).position().left;var am=ak.pageY-$(this).position().top;f={x:ai,y:am};var al=Math.map(ai,0,P,x,h);var aj=Math.map(am,0,m,w,g);if(l){Z.x1=V.x;Z.y1=V.y;Z.x2=f.x;if(v){Z.y2=V.y+(f.x-V.x)*0.8}else{Z.y2=f.y}ah()}}function ab(ai){switch(ai.which){case 1:V={x:ai.pageX-$(this).position().left,y:ai.pageY-$(this).position().top};l=true;break;case 3:J();break}}function ac(ak){if(ak.which===1){if(Z.x2-Z.x1>=0){var aj=Math.map(Z.x1,0,P,x,h);var am=Math.map(Z.x2,0,P,x,h)}else{var aj=Math.map(Z.x2,0,P,x,h);var am=Math.map(Z.x1,0,P,x,h)}if(Z.y2-Z.y1>=0){var ai=Math.map(Z.y1,0,m,w,g);var al=Math.map(Z.y2,0,m,w,g)}else{var ai=Math.map(Z.y2,0,m,w,g);var al=Math.map(Z.y1,0,m,w,g)}K({startX:aj,startY:ai,endX:am,endY:al});l=false}}function Y(am){var ak=am.target.files;for(var aj=0,al;al=ak[aj];aj++){if(!al.type.match("image.*")){continue}var ai=new FileReader();ai.onload=function(an){$("#gradient-preview").css({backgroundImage:'url("'+an.target.result+'")'});$("#imgGradient").attr("src",an.target.result);p=R(j[0]);d(x,h,w,g,u,p)};ai.readAsDataURL(al)}}var Z={x1:0,y1:0,x2:0,y2:0};function ah(){u.clearRect(0,0,P,m);u.putImageData(e,0,0);if(f&&V){u.lineWidth=5;u.strokeStyle="rgb(255,0,0)";u.strokeRect(Z.x1,Z.y1,Z.x2-Z.x1,Z.y2-Z.y1)}}};function q(){return{startX:parseFloat(Q.val()),endX:parseFloat(N.val()),startY:parseFloat(B.val()),endY:parseFloat(z.val())}}function G(){Q.val(x);N.val(h);B.val(w);z.val(g)}function K(Y,Z){if(!Z&&!t){n.push({startX:x,endX:h,startY:w,endY:g})}if(!t){M.push({startX:x,endX:h,startY:w,endY:g})}x=Y.startX;w=Y.startY;h=Y.endX;g=Y.endY;d(x,h,w,g,u,p)}function J(){if(n.length>0){K(n.pop(),true)}}function d(aa,ac,Y,ab,Z,ad){G();if(!e){e=Z.getImageData(0,0,P,m)}c.postMessage({message:"generateFrame",generateFrame:true,startX:aa,endX:ac,startY:Y,endY:ab,imageData:e,gradient:ad,canvasWidth:P,canvasHeight:m})}function I(ab){switch(ab.data.message){case"videoGenerationComplete":$(".long-load-playback").show();k.hide();C=ab.data.renderedFrames;var Y=0,ac=50;var Z=function(){if(Y<C.length){e.data.set(C[Y]);u.putImageData(e,0,0);setTimeout(Z,ac)}Y++};setTimeout(Z,ac);break;case"frameGenerationComplete":e=ab.data.imageData;u.putImageData(ab.data.imageData,0,0);S.text("Showing ["+x+" to "+h+"] x ["+w+" to "+g+"] Completed in: "+ab.data.timeTaken+" ms");break;case"generateZipComplete":location.href="data:application/zip;base64,"+ab.data.content;break;case"progressUpdate":var aa=Math.round((ab.data.frameCount/ab.data.frameTotal)*100);r.attr("value",aa);break}}function a(aa){var Z=new Date();var Y=null;do{Y=new Date()}while(Y-Z<aa)}function D(ab,ai,aa,ah,aj,af){var Y=aj.getImageData(0,0,P,m);for(var ag=0;ag<P;ag++){for(var ae=0;ae<m;ae++){var ac=Math.map(ag,0,P,ab,ai);var Z=Math.map(ae,0,m,aa,ah);var ad=F(ac,Z);Y.setPixel(af[ad],ag,ae)}}aj.putImageData(Y,0,0);return Y}var o=0,s=50;function U(){if(o<C.length){e.data.set(C[o]);u.putImageData(e,0,0);setTimeout(U,s)}else{o=0}o++}function R(ab){var Z=document.createElement("canvas");var aa=Z.getContext("2d");aa.drawImage(ab,0,0);var ad=aa.getImageData(0,0,ab.width,ab.height);var ac=new Array();for(var Y=0;Y<ab.width;Y++){ac.push(ad.getPixel(Y,0))}return ac}function F(ae,ac){var Z=0,Y=0,ad=500,aa=0,af=0;var ab;for(ab=0;ab<ad;ab++){if(Z*Z+Y*Y>4){break}aa=Z*Z-Y*Y+ae;af=2*Z*Y+ac;Z=aa;Y=af}return Math.floor(Math.map(ab,0,ad,0,254))}function A(ag){var ab="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var aa,Z,Y,ak,aj,ai,ah,al,af=0,am=0,ad="",ae=[];if(!ag){return ag}ag+="";do{ak=ab.indexOf(ag.charAt(af++));aj=ab.indexOf(ag.charAt(af++));ai=ab.indexOf(ag.charAt(af++));ah=ab.indexOf(ag.charAt(af++));al=ak<<18|aj<<12|ai<<6|ah;aa=al>>16&255;Z=al>>8&255;Y=al&255;if(ai==64){ae[am++]=String.fromCharCode(aa)}else{if(ah==64){ae[am++]=String.fromCharCode(aa,Z)}else{ae[am++]=String.fromCharCode(aa,Z,Y)}}}while(af<ag.length);ad=ae.join("");return ad}})();