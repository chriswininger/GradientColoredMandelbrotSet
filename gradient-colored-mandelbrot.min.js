(function(){if(typeof window.Math!=="undefined"){window.Math.map=function(e,b,a,d,c){return(e-b)/(Math.abs(a-b))*Math.abs(c-d)+d}}if(typeof window.ImageData!=="undefined"){ImageData.prototype.setPixel=function(f,a,e){var d=this.data;var b=4*(a+e*this.width);d[b]=f[0];d[b+1]=f[1];d[b+2]=f[2];d[b+3]=f[3]};ImageData.prototype.getPixel=function(a,d){var c=this.data;var b=4*(a+d*this.width);return[c[b],c[b+1],c[b+2],c[b+3]]}}String.prototype.padRight=function(f,b){var a=b-this.length,e="";for(var d=0;d<a;d++){e+=f}return this+e};String.prototype.padLeft=function(f,b){var a=b-this.length,e="";for(var d=0;d<a;d++){e+=f}return e+this}})();(function(){if(typeof window.GradientColoredMandelbrot=="undefined"){window.GradientColoredMandelbrot={}}window.GradientColoredMandelbrot.load_mandelbrot=function(y){var M=-2,Y=1,I=-1,X=1;var x=M,h=Y,w=I,g=X;var Q=500,m=400;var R=false,O=false,C=false,A=false,b=false,P=false,r=false,k=false,U=false,T=false,F=false;var z=false,f=false,l=false,W=false,v=true,t=false;var n=[],N=[];var i=false,u=false,j=false,e=false,p=false;var D=[];var c=false;window.onload=function(){R=$("#inputX1");O=$("#inputX2");C=$("#inputY1");A=$("#inputY2");r=$("#mandelbrot-color-video-progress");b=$("#lblStatus");P=$("#chkMandelbrotColorMaintainRatio");k=$("#long-load-display");U=$("#long-load-message");T=$("#lblSetInfo");F=$("#mandelbrot-color-download-tar");v=P.is(":checked");i=$("#cvsMandelbrotColor");Q=i.width();m=i.height();u=i[0].getContext("2d");j=$("#imgGradient");p=S(j[0]);c=new Worker(y.urlWorkerThread);c.onmessage=J;d(x,h,w,g,u,p);$("#btnUpdateMandelbrot").click(function(aj){L(q());return false});$("#play-long-video").click(function(aj){V()});$("#btnMandelbrotColorPlay").click(function(ak){t=true;N.push({startX:x,endX:h,startY:w,endY:g});for(var aj=0;aj<N.length;aj++){var al=N[aj];L(al)}t=false;N.pop()});F.click(function(al){k.show();var am=new Array();var aj=0;var ak=function(){if(aj<D.length){U.text("Processing Frames...");var ap=$("<canvas>").attr("width",Q).attr("height",m);var ao=ap[0].getContext("2d");e.data.set(D[aj]);ao.putImageData(e,0,0);var an=ap[0].toDataURL("image/jpeg",1);var aq=atob(an.substring(an.indexOf(",")+1));am.push({name:"p"+(aj.toString()).padLeft("0",10)+".jpeg",data:aq});r.attr("value",Math.round((aj/D.length)*100));aj++;window.setTimeout(ak,0)}else{U.text("Building Tar File...");jsTar.toTar(am,{complete:ah,error:ab,progress:af})}};window.setTimeout(ak,0)});function ah(aj){k.hide();if(aj.status==="success"){window.location.href=window.URL.createObjectURL(aj.data)}else{alert(aj.message)}}function ab(aj){k.hide();alert(aj.message)}function af(ak){var aj=Math.round((ak.count/ak.total)*100);r.attr("value",aj)}function ae(an){var aC="";for(var aw=0,aE=false,ak,aG,aD;aw<an.length;aw++){aE=an[aw];ak="";var aA=aE;var aI=("p"+(aw.toString()).padLeft("0",10)+".png").padRight("\0",100);var at="0000664".padRight("\0",8);var ap=(1000).toString(8).padLeft("0",7).padRight("\0",8);var az=(1000).toString(8).padLeft("0",7).padRight("\0",8);var ay=(aE.length).toString(8).padLeft("0",11).padRight("\0",12);var av="12123623701".padRight("\0",12);var ao="        ";var aH="0";var al="".padRight("\0",100);var aj="ustar  \0";var am="chris".padRight("\0",32);var au="chris".padRight("\0",32);ak=(aI+at+ap+az+ay+av+ao+aH+al+aj+am+au).padRight("\0",512);aG=0;for(var aB=0,ar;aB<ak.length;aB++){ar=ak.charCodeAt(aB);aG+=ar}ao=(aG).toString(8).padLeft("0",6)+"\0 ";aD=(aI+at+ap+az+ay+av+ao+aH+al+aj+am+au).padRight("\0",512);aD+=aA.padRight("\0",(512+Math.floor(aA.length/512)*512));aC+=aD}aC+="".padRight("\0",1024);var aq=new Uint8Array(aC.length);for(var ax=0;ax<aC.length;ax++){aq[ax]=aC.charCodeAt(ax)}var aF=new Blob([aq.buffer],{type:"application/tar"});window.location.href=window.URL.createObjectURL(aF)}$("#btnMandelbrotColorGenerateVideo").click(function(aj){N.push({startX:x,endX:h,startY:w,endY:g});var av=[];var ak=false;for(var ap=0;ap<N.length;ap++){var au=N[ap];if(ak===false){av.push(au)}else{var at=au.startX-ak.startX;var ar=au.startY-ak.startY;var aq=au.endX-ak.endX;var ao=au.endY-ak.endY;var ax=at/30;var aw=ar/30;var am=aq/30;var al=ao/30;for(var an=1;an<=30;an++){av.push({startX:ak.startX+ax*an,endX:ak.endX+am*an,startY:ak.startY+aw*an,endY:ak.endY+al*an})}}ak=au}N.pop();c.postMessage({message:"generateVideo",generateVideo:true,frameStates:av,imageData:e,gradient:p,canvasWidth:Q,canvasHeight:m});k.show()});$("#btnExportPath").click(function(ak){var al=$.toJSON(N);var aj=new Blob([al],{type:"text/plain;charset=utf-8"});saveAs(aj,"MandelBrotPath.txt")});P.change(function(aj){v=$(this).is(":checked")});$("#btnDefault").click(function(){L({startX:M,endX:Y,startY:I,endY:X})});$("#fileGradientPicker").change(Z);i.mousedown(ac);i.mouseup(ad);i.mousemove(ag);i.contextmenu(function(aj){return false});function ag(al){var aj=al.pageX-$(this).position().left;var an=al.pageY-$(this).position().top;f={x:aj,y:an};var am=Math.map(aj,0,Q,x,h);var ak=Math.map(an,0,m,w,g);if(l){aa.x1=W.x;aa.y1=W.y;aa.x2=f.x;if(v){aa.y2=W.y+(f.x-W.x)*0.8}else{aa.y2=f.y}ai()}}function ac(aj){switch(aj.which){case 1:W={x:aj.pageX-$(this).position().left,y:aj.pageY-$(this).position().top};l=true;break;case 3:K();break}}function ad(al){if(al.which===1){if(aa.x2-aa.x1>=0){var ak=Math.map(aa.x1,0,Q,x,h);var an=Math.map(aa.x2,0,Q,x,h)}else{var ak=Math.map(aa.x2,0,Q,x,h);var an=Math.map(aa.x1,0,Q,x,h)}if(aa.y2-aa.y1>=0){var aj=Math.map(aa.y1,0,m,w,g);var am=Math.map(aa.y2,0,m,w,g)}else{var aj=Math.map(aa.y2,0,m,w,g);var am=Math.map(aa.y1,0,m,w,g)}L({startX:ak,startY:aj,endX:an,endY:am});l=false}}function Z(an){var al=an.target.files;for(var ak=0,am;am=al[ak];ak++){if(!am.type.match("image.*")){continue}var aj=new FileReader();aj.onload=function(ao){$("#gradient-preview").css({backgroundImage:'url("'+ao.target.result+'")'});$("#imgGradient").attr("src",ao.target.result);p=S(j[0]);d(x,h,w,g,u,p)};aj.readAsDataURL(am)}}var aa={x1:0,y1:0,x2:0,y2:0};function ai(){u.clearRect(0,0,Q,m);u.putImageData(e,0,0);if(f&&W){u.lineWidth=5;u.strokeStyle="rgb(255,0,0)";u.strokeRect(aa.x1,aa.y1,aa.x2-aa.x1,aa.y2-aa.y1)}}};function q(){return{startX:parseFloat(R.val()),endX:parseFloat(O.val()),startY:parseFloat(C.val()),endY:parseFloat(A.val())}}function H(){R.val(x);O.val(h);C.val(w);A.val(g)}function L(Z,aa){if(!aa&&!t){n.push({startX:x,endX:h,startY:w,endY:g})}if(!t){N.push({startX:x,endX:h,startY:w,endY:g})}x=Z.startX;w=Z.startY;h=Z.endX;g=Z.endY;d(x,h,w,g,u,p)}function K(){if(n.length>0){L(n.pop(),true)}}function d(ab,ad,Z,ac,aa,ae){H();if(!e){e=aa.getImageData(0,0,Q,m)}c.postMessage({message:"generateFrame",generateFrame:true,startX:ab,endX:ad,startY:Z,endY:ac,imageData:e,gradient:ae,canvasWidth:Q,canvasHeight:m})}function J(ac){switch(ac.data.message){case"videoGenerationComplete":$(".long-load-playback").show();k.hide();D=ac.data.renderedFrames;var Z=0,ad=50;var aa=function(){if(Z<D.length){e.data.set(D[Z]);u.putImageData(e,0,0);setTimeout(aa,ad)}Z++};setTimeout(aa,ad);break;case"frameGenerationComplete":e=ac.data.imageData;u.putImageData(ac.data.imageData,0,0);T.text("Showing ["+x+" to "+h+"] x ["+w+" to "+g+"] Completed in: "+ac.data.timeTaken+" ms");break;case"generateZipComplete":location.href="data:application/zip;base64,"+ac.data.content;break;case"progressUpdate":var ab=Math.round((ac.data.frameCount/ac.data.frameTotal)*100);r.attr("value",ab);break}}function a(ab){var aa=new Date();var Z=null;do{Z=new Date()}while(Z-aa<ab)}function E(ac,aj,ab,ai,ak,ag){var Z=ak.getImageData(0,0,Q,m);for(var ah=0;ah<Q;ah++){for(var af=0;af<m;af++){var ad=Math.map(ah,0,Q,ac,aj);var aa=Math.map(af,0,m,ab,ai);var ae=G(ad,aa);Z.setPixel(ag[ae],ah,af)}}ak.putImageData(Z,0,0);return Z}var o=0,s=50;function V(){if(o<D.length){e.data.set(D[o]);u.putImageData(e,0,0);setTimeout(V,s)}else{o=0}o++}function S(ac){var aa=document.createElement("canvas");var ab=aa.getContext("2d");ab.drawImage(ac,0,0);var ae=ab.getImageData(0,0,ac.width,ac.height);var ad=new Array();for(var Z=0;Z<ac.width;Z++){ad.push(ae.getPixel(Z,0))}return ad}function G(af,ad){var aa=0,Z=0,ae=500,ab=0,ag=0;var ac;for(ac=0;ac<ae;ac++){if(aa*aa+Z*Z>4){break}ab=aa*aa-Z*Z+af;ag=2*aa*Z+ad;aa=ab;Z=ag}return Math.floor(Math.map(ac,0,ae,0,254))}function B(ah){var ad="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var ab,aa,Z,al,ak,aj,ai,am,ag=0,an=0,ae="",af=[];if(!ah){return ah}ah+="";do{al=ad.indexOf(ah.charAt(ag++));ak=ad.indexOf(ah.charAt(ag++));aj=ad.indexOf(ah.charAt(ag++));ai=ad.indexOf(ah.charAt(ag++));am=al<<18|ak<<12|aj<<6|ai;ab=am>>16&255;aa=am>>8&255;Z=am&255;if(aj==64){af[an++]=String.fromCharCode(ab)}else{if(ai==64){af[an++]=String.fromCharCode(ab,aa)}else{af[an++]=String.fromCharCode(ab,aa,Z)}}}while(ag<ah.length);ae=af.join("");return ae}}})();